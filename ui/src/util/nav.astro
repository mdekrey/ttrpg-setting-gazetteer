---
import { sections } from '@/content/sections';
import { getContentEntries } from '@/content/utils.astro';

export type NavEntryBase = {
	text: string;
};
export type PageNavEntry = NavEntryBase & {
	slug: string;
	header?: false;
};
export type HeaderNavEntry = NavEntryBase & {
	header: true;
};
export type NavEntry = PageNavEntry | HeaderNavEntry;

export async function getNavigation(): Promise<NavEntry[]> {
	const contentEntries = (await getContentEntries())
		.filter(article => !article.frontmatter.draft)
		.map((article): PageNavEntry => {
			return { text: article.frontmatter.title, slug: article.url };
		});

	const final = contentEntries.reduce((result, next) => {
		const last = result[result.length - 1];

		const section = next.slug.split('/')[0] ?? '';

		if (!last || (!last.header && last.slug.split('/')[0] !== section )) {
			const text = sections[section];
			if (!text) return result;
			result.push({ text, header: true });
		}
		result.push(next);

		return result;
	}, [] as NavEntry[]);

	return final;
}
---
